#!/usr/bin/env python3
#
# Given some training set, generate a random subset and evaluate it's
# effectiveness against a test set.
#
import csv
import sys
import os

import numpy as np
import pandas as pd
import math

from argparse import ArgumentParser
from collections import defaultdict
from random import random

import labm8
from labm8 import fs
from labm8 import math as labmath
from multiprocessing import cpu_count, Pool

import smith
from smith import features
from smith import cgo13

def main():
    parser = ArgumentParser()
    parser.add_argument('input', help='path to training data CSV')
    parser.add_argument("subset", help='subset splitting strategy')
    parser.add_argument('outdir', help='path to training data CSV')
    args = parser.parse_args()

    data = cgo13.LabelledData.from_csv(smith.assert_exists(args.input),
                                       group_by=args.subset)
    groups = sorted(list(set(data["Group"])))
    outdir = fs.mkdir(args.outdir)

    group_indices = defaultdict(list)
    for i,d in enumerate(data.to_dict(orient="records")):
        group_indices[d["Group"]].append(i)

    for group in groups:
        outpath = fs.path(outdir, str(group) + ".csv")
        print(outpath)
        data.ix[np.array(group_indices[group])].to_csv(outpath)


if __name__ == '__main__':
    main()
