#!/usr/bin/env bash
#
# Create plots.
#

main() {
    local dir=data/img

    rm -rfv $dir
    mkdir -pv $dir

    ########################## BENCHMARKS ##############################

    # Benchmarks feature space
    smith-plot features benchmarks/data/platform-b.csv \
               --group class -o $dir/bench-features-class-B.pdf \
               --title "Benchmarks results for Platform B" &
    smith-plot features benchmarks/data/platform-b.csv \
               --group suite -o $dir/bench-features-suite-B.pdf \
               --title "Benchmarks results for Platform B" &

    smith-plot features benchmarks/data/platform-a.csv \
               --group class -o $dir/bench-features-class-A.pdf \
               --title "Benchmarks results for Platform A" &
    smith-plot features benchmarks/data/platform-a.csv \
               --group suite -o $dir/bench-features-class-A.pdf \
               --title "Benchmarks results for Platform A" &

    smith-plot features benchmarks/data/training-combined.csv \
               --group class -o $dir/bench-features-class-C.pdf \
               --title "Benchmarks results for both experimental platforms" &
    smith-plot features benchmarks/data/training-combined.csv \
               --group suite -o $dir/bench-features-class-C.pdf \
               --title "Benchmarks results for both experimental platforms" &


    # Cross-benchmark machine learning:
    smith-plot xval benchmarks/data/platform-a.csv \
               --group suite -o $dir/bench-xval-bench-A.pdf \
               --title "Cross-benchmark autotuning for Platform B" &

    smith-plot xval benchmarks/data/platform-b.csv \
               --group suite -o $dir/bench-xval-bench-B.pdf \
               --title "Cross-benchmark autotuning for Platform B" &


    ######################### SYNTHETICS ##############################

    # Synthetic feature space
    smith-plot features driver/data/synthetic/platform-b.csv \
               --group class -o $dir/syn-features-class-B.pdf \
               --title "Synthetic kernels for Platform B" &

    smith-plot features driver/data/synthetic/platform-a.csv \
               --group class \-o $dir/syn-features-class-A.pdf \
               --title "Synthetic kernels for Platform A" &

    smith-plot features driver/data/synthetic/training-combined.csv \
               --group class -o $dir/syn-features-class-C.pdf \
               --title "Synthetic kernels for both experimental platforms" &


    for job in `jobs -p`
    do
        wait $job
    done

    if which xdg-open &>/dev/null ; then
        xdg-open $dir
    else
        open $dir
    fi
}
main $@
