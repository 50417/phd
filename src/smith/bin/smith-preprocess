#!/usr/bin/env python3
#
# Preprocess the raw dataset.
#
from argparse import ArgumentParser

import smith
from smith import preprocess


def main():
    parser = ArgumentParser()
    parser.add_argument('inputs', nargs='+', help='path to input')
    parser.add_argument('-f', '--file', action='store_true', help='treat input as file')
    parser.add_argument('-i', '--inplace', action='store_true', help='inplace file rewrite')
    parser.add_argument('--remove-bad-preprocessed', action='store_true', help=(
        "delete the contents of all bad or ugly preprocessed files, but keep "
        "the entries in the table"))
    args = parser.parse_args()

    if args.file and args.inplace:
        preprocess.preprocess_inplace(args.inputs)
    else:
        for path in args.inputs:
            if args.file:
                preprocess.preprocess_file(path, inplace=False)
            else:
                if args.remove_bad_preprocessed:
                    preprocess.remove_bad_preprocessed(path)
                else:
                    preprocess.preprocess_db(path)


if __name__ == '__main__':
    main()
