#!/usr/bin/env python3
#
# Preprocess the raw dataset.
#
from argparse import ArgumentParser

import smith
from smith import preprocess


def main():
    parser = ArgumentParser()
    parser.add_argument('inputs', nargs='+', help='path to input')
    parser.add_argument('-f', action='store_true', help='treat input as file')
    parser.add_argument('-i', action='store_true', help='inplace file rewrite')
    parser.add_argument('--vacuum', action='store_true',
                        help='remove error output and squeeze database')
    args = parser.parse_args()

    input_paths = args.inputs
    file_mode = args.f
    inplace_mode = args.i

    for input_path in input_paths:
        if file_mode:
            if inplace_mode:
                print(input_path)
            preprocess.preprocess_file(input_path, inplace=inplace_mode)
        else:
            if args.vacuum:
                preprocess.vacuum(input_path)
            else:
                preprocess.preprocess_db(input_path)


if __name__ == '__main__':
    main()
