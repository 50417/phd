# A tiny corpus of OpenCL kernels and a correspondingly small model.
# It should take around 30 minutes to train on a reasonably powerful GPU,
# and maybe around an hour on a CPU.
# File: //deeplearning/deepsmith/proto/clgen.proto
# Proto: clgen.Instance
working_dir: "/var/phd/clgen/mdl"
model {
  corpus {
    local_tar_archive: "$PWD/20mdl.tar.bz2"
    # ascii_character_atomizer: true
    greedy_multichar_atomizer {
      tokens: "Model"
      tokens: "Name"
      tokens: "System"
      tokens: "Location"
      tokens: "Open"
      tokens: "PortBlocksUseCompactNotation"
      tokens: "ModelBrowserVisibility"
      tokens: "ModelBrowserWidth"
      tokens: "ScreenColor"
      tokens: "PaperOrientation"
      tokens: "PaperPositionMode"
      tokens: "PaperType"
      tokens: "PaperUnits"
      tokens: "TiledPaperMargins"
      tokens: "TiledPageScale"
      tokens: "ShowPageBoundaries"
      tokens: "ZoomFactor"
      tokens: "ReportName"
      tokens: "SIDHighWatermark"
      tokens: "BlockType"
      tokens: "SID"
      tokens: "Ports"
      tokens: "Position"
      tokens: "ZOrder"
      tokens: "LibraryVersion"
      tokens: "SourceBlock"
      tokens: "SourceType"
      tokens: "SourceProductName"
      tokens: "SourceProductBaseCode"
      tokens: "vinit"
      tokens: "samptime"
      tokens: "NumDelays"
      tokens: "DelayOrder"
      tokens: "includeCurrent"
      tokens: "InputPortMap"
      tokens: "SampleTime"
      tokens: "OutDataTypeStr"
      tokens: "RndMeth"
      tokens: "SaturateOnIntegerOverflow"
      tokens: "ContentPreviewEnabled"
      tokens: "Controller"
      tokens: "TimeDomain"
      tokens: "IntegratorMethod"
      tokens: "FilterMethod"
      tokens: "Form"
      tokens: "UseFilter"
      tokens: "ControllerParametersSource"
      tokens: "P"
      tokens: "I"
      tokens: "D"
      tokens: "N"
      tokens: "InitialConditionSource"
      tokens: "InitialConditionForIntegrator"
      tokens: "InitialConditionForFilter"
      tokens: "ExternalReset"
      tokens: "IgnoreLimit"
      tokens: "ZeroCross"
      tokens: "LimitOutput"
      tokens: "UpperSaturationLimit"
      tokens: "LowerSaturationLimit"
      tokens: "LinearizeAsGain"
      tokens: "AntiWindupMode"
      tokens: "Kb"
      tokens: "TrackingMode"
      tokens: "Kt"
      tokens: "LockScale"
      tokens: "PParamMin"
      tokens: "PParamMax"
      tokens: "PParamDataTypeStr"
      tokens: "IParamMin"
      tokens: "IParamMax"
      tokens: "IParamDataTypeStr"
      tokens: "DParamMin"
      tokens: "DParamMax"
      tokens: "DParamDataTypeStr"
      tokens: "NParamMin"
      tokens: "NParamMax"
      tokens: "NParamDataTypeStr"
      tokens: "KbParamMin"
      tokens: "KbParamMax"
      tokens: "KbParamDataTypeStr"
      tokens: "KtParamMin"
      tokens: "KtParamMax"
      tokens: "KtParamDataTypeStr"
      tokens: "POutMin"
      tokens: "POutMax"
      tokens: "POutDataTypeStr"
      tokens: "PGainOutDataTypeStr"
      tokens: "PProdOutDataTypeStr"
      tokens: "IOutMin"
      tokens: "IOutMax"
      tokens: "IOutDataTypeStr"
      tokens: "IGainOutDataTypeStr"
      tokens: "IProdOutDataTypeStr"
      tokens: "DOutMin"
      tokens: "DOutMax"
      tokens: "DOutDataTypeStr"
      tokens: "DGainOutDataTypeStr"
      tokens: "DProdOutDataTypeStr"
      tokens: "NOutMin"
      tokens: "NOutMax"
      tokens: "NOutDataTypeStr"
      tokens: "NGainOutDataTypeStr"
      tokens: "NProdOutDataTypeStr"
      tokens: "KbOutMin"
      tokens: "KbOutMax"
      tokens: "KbOutDataTypeStr"
      tokens: "KtOutMin"
      tokens: "KtOutMax"
      tokens: "KtOutDataTypeStr"
      tokens: "IntegratorOutMin"
      tokens: "IntegratorOutMax"
      tokens: "IntegratorOutDataTypeStr"
      tokens: "FilterOutMin"
      tokens: "FilterOutMax"
      tokens: "FilterOutDataTypeStr"
      tokens: "SumOutMin"
      tokens: "SumOutMax"
      tokens: "SumOutDataTypeStr"
      tokens: "SumI1OutMin"
      tokens: "SumI1OutMax"
      tokens: "SumI1OutDataTypeStr"
      tokens: "SumI2OutMin"
      tokens: "SumI2OutMax"
      tokens: "SumI2OutDataTypeStr"
      tokens: "SumI3OutMin"
      tokens: "SumI3OutMax"
      tokens: "SumI3OutDataTypeStr"
      tokens: "SumDOutMin"
      tokens: "SumDOutMax"
      tokens: "SumDOutDataTypeStr"
      tokens: "SumAccumDataTypeStr"
      tokens: "SumI1AccumDataTypeStr"
      tokens: "SumI2AccumDataTypeStr"
      tokens: "SumI3AccumDataTypeStr"
      tokens: "SumDAccumDataTypeStr"
      tokens: "SaturationOutMin"
      tokens: "SaturationOutMax"
      tokens: "SaturationOutDataTypeStr"
      tokens: "IntegratorContinuousStateAttributes"
      tokens: "IntegratorStateMustResolveToSignalObject"
      tokens: "IntegratorRTWStateStorageClass"
      tokens: "FilterContinuousStateAttributes"
      tokens: "FilterStateMustResolveToSignalObject"
      tokens: "FilterRTWStateStorageClass"
      tokens: "DifferentiatorICPrevScaledInput"
      tokens: "DifferentiatorOutMin"
      tokens: "DifferentiatorOutMax"
      tokens: "DifferentiatorOutDataTypeStr"
      tokens: "InitialConditionSetting"
      tokens: "PoleZ"
      tokens: "ZeroZ"
      tokens: "ICPrevOutput"
      tokens: "ICPrevInput"
      tokens: "DoSatur"
      tokens: "Poles"
      tokens: "Gain"
      tokens: "uplimit"
      tokens: "tsamp"
      tokens: "SrcBlock"
      tokens: "SrcPort"
      tokens: "Points"
      tokens: "DstBlock"
      tokens: "DstPort"
      tokens: "DelayLengthSource"
      tokens: "ICPrevScaledInput"
      tokens: "xmin"
      tokens: "xmax"
      tokens: "ymin"
      tokens: "ymax"
      tokens: "st"
      tokens: "f1"
      tokens: "T"
      tokens: "f2"
      tokens: "VectorParams1D"
      tokens: "After"
      tokens: "OutValues"
      tokens: "OutMin"
      tokens: "OutMax"
      tokens: "OutputDataTypeScalingMode"
      tokens: "OutDataType"
      tokens: "ConRadixGroup"
      tokens: "OutScaling"
      tokens: "InputProcessing"
      tokens: "NumInputPorts"
      tokens: "Floating"
      tokens: "Units"
      tokens: "Tag"
      tokens: "Outputs"
      tokens: "VariableName"
      tokens: "SigBuilderData"
      tokens: "VnvData"
      tokens: "IconDisplay"
      tokens: "Value"
      tokens: "NumRecords"
      tokens: "Data"
      tokens: "OutputPortMap"
      tokens: "ShowEnablePort"
      tokens: "b"
      tokens: "c"
      tokens: "bParamMin"
      tokens: "bParamMax"
      tokens: "bParamDataTypeStr"
      tokens: "cParamMin"
      tokens: "cParamMax"
      tokens: "cParamDataTypeStr"
      tokens: "bOutMin"
      tokens: "bOutMax"
      tokens: "bOutDataTypeStr"
      tokens: "bGainOutDataTypeStr"
      tokens: "bProdOutDataTypeStr"
      tokens: "cOutMin"
      tokens: "cOutMax"
      tokens: "cOutDataTypeStr"
      tokens: "cGainOutDataTypeStr"
      tokens: "cProdOutDataTypeStr"
      tokens: "Sum1OutMin"
      tokens: "Sum1OutMax"
      tokens: "Sum1OutDataTypeStr"
      tokens: "Sum2OutMin"
      tokens: "Sum2OutMax"
      tokens: "Sum2OutDataTypeStr"
      tokens: "Sum3OutMin"
      tokens: "Sum3OutMax"
      tokens: "Sum3OutDataTypeStr"
      tokens: "Sum1AccumDataTypeStr"
      tokens: "Sum2AccumDataTypeStr"
      tokens: "Sum3AccumDataTypeStr"
      tokens: "TimeValues"
      tokens: "LookUpMeth"
      tokens: "Decimation"
      tokens: "MaxDataPoints"
      tokens: "SaveFormat"
      tokens: "Save2DSignal"
      tokens: "FixptAsFi"
      tokens: "Filename"
      tokens: "PulseType"
      tokens: "Period"
      tokens: "PulseWidth"
      tokens: "Cov"
      tokens: "Ts"
      tokens: "seed"
      }
    contentfile_separator: "\n\n"
    preprocessor: "deeplearning.clgen.preprocessors.common:StripDuplicateEmptyLines"
    preprocessor: "deeplearning.clgen.preprocessors.common:StripDuplicateEmptyLines"
    preprocessor: "deeplearning.clgen.preprocessors.common:StripDuplicateWhiteSpaces"
    preprocessor: "deeplearning.clgen.preprocessors.common:StripTrailingWhitespace"
  }
  architecture {
    backend: TENSORFLOW
    neuron_type: LSTM
    neurons_per_layer: 128
    num_layers: 2
    post_layer_dropout_micros: 0  # = 0.0 real value
  }
  training {
    num_epochs: 32
    sequence_length: 64
    batch_size: 64
    shuffle_corpus_contentfiles_between_epochs: false
    adam_optimizer {
      initial_learning_rate_micros: 2000  # = 0.01 real value
      learning_rate_decay_per_epoch_micros: 50000  # = 0.05 real value
      beta_1_micros: 900000  # = 0.9 real value
      beta_2_micros: 999000  # = 0.999 real value
      normalized_gradient_clip_micros: 5000000  # = 5.0 real value
    }
  }
}
sampler {
  start_text: "Model {\nName \"toymdl\"\nSystem "   
  batch_size: 1
  temperature_micros: 80000  # = 0.8 real value
  termination_criteria {
    symtok {
      depth_increase_token: "{"
      depth_decrease_token: "}"
    }
  }
  termination_criteria {
    maxlen {
      maximum_tokens_in_sample: 24000
    }
  }
}
